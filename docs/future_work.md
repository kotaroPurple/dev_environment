# 並列化拡張に向けた検討メモ

## 現状の制約
- `StreamDataLoader` は単一ブロックずつ同期取得する設計で、先読みやマルチワーカーを持たない
- `PipelineOrchestrator` は各ノードの処理完了を待ってから次ブロックを要求するため、処理時間がそのままレイテンシになる
- 共有バッファはメモリ常駐を前提としており、ブロックサイズが大きい場合はメモリ圧力が高まる

## 拡張アイデア
1. **プリフェッチ対応**
   - `StreamDataLoader` にリングバッファを追加し、別スレッドで `read_block()` を先行実行
   - 組み込み向けにはワーカースレッド数を 1 または 2 に制限し、割り込み処理と競合しないようにする
2. **ノード並列化**
   - ノードごとに非同期実行キューを導入し、依存解決後に並列执行できるノードをスケジューリング
   - 実時間制約を守るため、最大実行時間のバジェット管理を導入
3. **バックプレッシャ**
   - モニタリング層にキュー深度を追加し、一定値を超えた場合はデータロードを一時停止
   - `ErrorPolicy` に `PAUSE` (次ブロック取得を遅延) などを追加する余地あり

## 必要な変更点
- データローダとオーケストレータ間のインターフェース拡張 (`next_block()` に非同期オプション)
- `BlockBuffer` をスレッドセーフにする、またはノードごとに独立したコンテナを用意
- テスト戦略に負荷試験・並列アクセステストを追加する
- ドキュメントでリアルタイム制約とタイミングチャートを解説する
